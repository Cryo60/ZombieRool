package net.mcreator.zombierool.mixins;

import net.minecraft.world.damagesource.DamageSource;
import net.minecraft.world.entity.LivingEntity;
import net.minecraft.world.entity.player.Player;
import org.spongepowered.asm.mixin.Mixin;
import org.spongepowered.asm.mixin.injection.At;
import org.spongepowered.asm.mixin.injection.Inject;
import org.spongepowered.asm.mixin.injection.callback.CallbackInfoReturnable;

import java.lang.reflect.Field;

@Mixin(LivingEntity.class)
public abstract class CancelInvulnerabilityMixin {

    @Inject(method = "hurt", at = @At("RETURN"))
    private void zombierool_cancelInvulnerabilityOnDamage(DamageSource source, float amount, CallbackInfoReturnable<Boolean> cir) {
        LivingEntity entity = (LivingEntity)(Object)this;

        if (!(entity instanceof Player) && cir.getReturnValue()) {
            try {
                Field field = LivingEntity.class.getDeclaredField("f_21083_"); // Mojang-obfuscated name
                field.setAccessible(true);
                field.setInt(entity, 0);
            } catch (NoSuchFieldException | IllegalAccessException e) {
                e.printStackTrace();
            }
        }
    }
}
